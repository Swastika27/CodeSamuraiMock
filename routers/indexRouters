const express = require('express');
const Book = require('../models/book.js');
const app = require('../app.js');

const router = express.Router({mergeParams : true});

router.post('/', async(req, res) => {
    // add books
    const book = new Book(req.body);

    const id = req.body.id;

    book.save()
        .then((result) => {
            res.status(201).json(req.body);
        })
        .catch((err) => {
            console.log(err);
        })
    // failure response not needed
})

router.put('/:id', async (req, res) => {
    const id = req.params.id;

    try {
        // Find the book by id and update its details
        const updatedBook = await Book.findByIdAndUpdate(id, req.body, { new: true });

        // If the book is found and updated successfully
        if (updatedBook) {
            res.status(200).json(updatedBook);
        } else {
            // If the requested book does not exist
            res.status(404).json({ error: 'Book not found' });
        }
    } catch (error) {
        console.log(error);
        res.status(500).json({ error: 'Internal Server Error' });
    }
});

router.get('/:id', async(req, res) => {
    // fetch book by id
    // request will not have any body

   
})

router.get('/', (req, res) => {
    // Extract query parameters
    const title = req.query.title;
    const author = req.query.author;
    const sort = req.query.sort;
    const order = req.query.order;
  
    console.log(title);
    console.log(author);
    console.log(sort);
    console.log(order);
    res.send("got requst");

    // the request may contain 0 or more query parameters. when 0 parameter, if fetches all books.
    // response should contain an array named book that contains all books
    // success response
    // no failure response


  });


  module.exports = router;